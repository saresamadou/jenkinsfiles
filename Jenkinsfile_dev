node {
    try{
        
        deleteDir()
        cleanWs()
        
        stage('Checkout source') {
           echo 'This stage will be executed first.'
           def scmVars = checkout scm
           scmVars.each{key, value -> echo "${key} : ${value}"}
        }
        stage ('Build stage') {
            echo 'Second stage'
        }
        
        stage ('Test stage') {
            echo env.PATH
        }
        
        stage('Deploy') {
            deploy(currentBuild.result)
        }
    }
    
    catch(Exception ex) {
        echo 'Exception happened' + ex.getStackTrace() 
    }
    
    finally
    {
            echo 'End of the pipeline'
    } 
   }

     def deploy(result) 
   {
            if(result == null || result == 'SUCCESS') {
             echo 'Deploying ...'
            }
   }
       
